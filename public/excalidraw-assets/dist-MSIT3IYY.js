import{J as Ct,b as It,c as Ot,sb as G}from"./chunk-SDI36ZKF.js";import{a as h}from"./chunk-M2JW2GFW.js";import{d as kt,f as z}from"./chunk-SXMPUQ6M.js";var nt=kt(W=>{"use strict";h();Object.defineProperty(W,"__esModule",{value:!0});W.removeMarkdown=void 0;var Nt=function(t,e){e===void 0&&(e={listUnicodeChar:""}),e=e||{},e.listUnicodeChar=e.hasOwnProperty("listUnicodeChar")?e.listUnicodeChar:!1,e.stripListLeaders=e.hasOwnProperty("stripListLeaders")?e.stripListLeaders:!0,e.gfm=e.hasOwnProperty("gfm")?e.gfm:!0,e.useImgAltText=e.hasOwnProperty("useImgAltText")?e.useImgAltText:!0,e.preserveLinks=e.hasOwnProperty("preserveLinks")?e.preserveLinks:!1;var r=t||"";r=r.replace(/^(-\s*?|\*\s*?|_\s*?){3,}\s*$/gm,"");try{e.stripListLeaders&&(e.listUnicodeChar?r=r.replace(/^([\s\t]*)([\*\-\+]|\d+\.)\s+/gm,e.listUnicodeChar+" $1"):r=r.replace(/^([\s\t]*)([\*\-\+]|\d+\.)\s+/gm,"$1")),e.gfm&&(r=r.replace(/\n={2,}/g,`
`).replace(/~{3}.*\n/g,"").replace(/~~/g,"").replace(/`{3}.*\n/g,"")),e.preserveLinks&&(r=r.replace(/\[(.*?)\][\[\(](.*?)[\]\)]/g,"$1 ($2)")),r=r.replace(/<[^>]*>/g,"").replace(/^[=\-]{2,}\s*$/g,"").replace(/\[\^.+?\](\: .*?$)?/g,"").replace(/\s{0,2}\[.*?\]: .*?$/g,"").replace(/\!\[(.*?)\][\[\(].*?[\]\)]/g,e.useImgAltText?"$1":"").replace(/\[(.*?)\][\[\(].*?[\]\)]/g,"$1").replace(/^\s{0,3}>\s?/g,"").replace(/(^|\n)\s{0,3}>\s?/g,`

`).replace(/^\s{1,2}\[(.*?)\]: (\S+)( ".*?")?\s*$/g,"").replace(/^(\n)?\s{0,}#{1,6}\s+| {0,}(\n)?\s{0,}#{0,} {0,}(\n)?\s{0,}$/gm,"$1$2$3").replace(/([\*_]{1,3})(\S.*?\S{0,1})\1/g,"$2").replace(/([\*_]{1,3})(\S.*?\S{0,1})\1/g,"$2").replace(/(`{3,})(.*?)\1/gm,"$2").replace(/`(.+?)`/g,"$1").replace(/\n{2,}/g,`

`)}catch(o){return console.error(o),t}return r};W.removeMarkdown=Nt});h();h();var st={rect:"rectangle",circle:"ellipse"},J={startOnLoad:!1,flowchart:{curve:"linear"},themeVariables:{fontSize:`${20*1.25}px`},maxEdges:500,maxTextSize:5e4};h();h();h();var L=class{constructor({converter:e}){this.convert=(r,o)=>this.converter(r,{...o,fontSize:o.fontSize||20}),this.converter=e}};h();h();var R;(function(t){t.ROUND="round",t.STADIUM="stadium",t.DOUBLECIRCLE="doublecircle",t.CIRCLE="circle",t.DIAMOND="diamond"})(R||(R={}));var V;(function(t){t.COLOR="color"})(V||(V={}));var $;(function(t){t.FILL="fill",t.STROKE="stroke",t.STROKE_WIDTH="stroke-width",t.STROKE_DASHARRAY="stroke-dasharray"})($||($={}));var at=z(nt(),1),Lt={arrow_circle:{endArrowhead:"dot"},arrow_cross:{endArrowhead:"bar"},arrow_open:{endArrowhead:null,startArrowhead:null},double_arrow_circle:{endArrowhead:"dot",startArrowhead:"dot"},double_arrow_cross:{endArrowhead:"bar",startArrowhead:"bar"},double_arrow_point:{endArrowhead:"arrow",startArrowhead:"arrow"}},it=t=>Lt[t],U=t=>{let e=t.text;return t.labelType==="markdown"&&(e=(0,at.removeMarkdown)(t.text)),_t(e)},_t=t=>{let e=/\s?(fa|fab):[a-zA-Z0-9-]+/g;return t.replace(e,"")},ct=t=>{let e={};return Object.keys(t).forEach(r=>{switch(r){case $.FILL:{e.backgroundColor=t[r],e.fillStyle="solid";break}case $.STROKE:{e.strokeColor=t[r];break}case $.STROKE_WIDTH:{e.strokeWidth=Number(t[r]?.split("px")[0]);break}case $.STROKE_DASHARRAY:{e.strokeStyle="dashed";break}}}),e},lt=t=>{let e={};return Object.keys(t).forEach(r=>{switch(r){case V.COLOR:{e.strokeColor=t[r];break}}}),e};var Dt=t=>{let e={};t.subGraphs.map(o=>{o.nodeIds.forEach(n=>{e[o.id]={id:o.id,parent:null,isLeaf:!1},e[n]={id:n,parent:o.id,isLeaf:t.vertices[n]!==void 0}})});let r={};return[...Object.keys(t.vertices),...t.subGraphs.map(o=>o.id)].forEach(o=>{if(!e[o])return;let n=e[o],i=[];for(n.isLeaf||i.push(`subgraph_group_${n.id}`);n.parent;)i.push(`subgraph_group_${n.parent}`),n=e[n.parent];r[o]=i}),{getGroupIds:o=>r[o]||[],getParentId:o=>e[o]?e[o].parent:null}},dt=new L({converter:(t,e)=>{let r=[],o=e.fontSize,{getGroupIds:n,getParentId:i}=Dt(t);return t.subGraphs.reverse().forEach(s=>{let a=n(s.id),c={id:s.id,type:"rectangle",groupIds:a,x:s.x,y:s.y,width:s.width,height:s.height,label:{groupIds:a,text:U(s),fontSize:o,verticalAlign:"top"}};r.push(c)}),Object.values(t.vertices).forEach(s=>{if(!s)return;let a=n(s.id),c=ct(s.containerStyle),l=lt(s.labelStyle),d={id:s.id,type:"rectangle",groupIds:a,x:s.x,y:s.y,width:s.width,height:s.height,strokeWidth:2,label:{groupIds:a,text:U(s),fontSize:o,...l},link:s.link||null,...c};switch(s.type){case R.STADIUM:{d={...d,roundness:{type:3}};break}case R.ROUND:{d={...d,roundness:{type:3}};break}case R.DOUBLECIRCLE:{a.push(`doublecircle_${s.id}}`);let f={type:"ellipse",groupIds:a,x:s.x+5,y:s.y+5,width:s.width-5*2,height:s.height-5*2,strokeWidth:2,roundness:{type:3},label:{groupIds:a,text:U(s),fontSize:o}};d={...d,groupIds:a,type:"ellipse"},r.push(f);break}case R.CIRCLE:{d.type="ellipse";break}case R.DIAMOND:{d.type="diamond";break}}r.push(d)}),t.edges.forEach(s=>{let a=[],c=i(s.start),l=i(s.end);c&&c===l&&(a=n(c));let{startX:d,startY:u,reflectionPoints:f}=s,m=f.map(p=>[p.x-f[0].x,p.y-f[0].y]),x=it(s.type),E={id:`${s.start}_${s.end}`,type:"arrow",groupIds:a,x:d,y:u,strokeWidth:s.stroke==="thick"?4:2,strokeStyle:s.stroke==="dotted"?"dashed":void 0,points:m,...s.text?{label:{text:U(s),fontSize:o,groupIds:a}}:{},roundness:{type:2},...x},y=r.find(p=>p.id===s.start),w=r.find(p=>p.id===s.end);!y||!w||(E.start={id:y.id||""},E.end={id:w.id||""},r.push(E))}),{elements:r}}});h();h();var O=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,r)=>(r&=63,r<36?e+=r.toString(36):r<62?e+=(r-26).toString(36).toUpperCase():r>62?e+="-":e+="_",e),"");var ut=new L({converter:t=>{let e=O(),{width:r,height:o}=t,n={type:"image",x:0,y:0,width:r,height:o,status:"saved",fileId:e};return{files:{[e]:{id:e,mimeType:t.mimeType,dataURL:t.dataURL}},elements:[n]}}});h();h();var tt=t=>t.replace(/\\n/g,`
`),M=t=>{let e={type:"line",x:t.startX,y:t.startY,points:[[0,0],[t.endX-t.startX,t.endY-t.startY]],width:t.endX-t.startX,height:t.endY-t.startY,strokeStyle:t.strokeStyle||"solid",strokeColor:t.strokeColor||"#000",strokeWidth:t.strokeWidth||1};return t.groupId&&Object.assign(e,{groupIds:[t.groupId]}),t.id&&Object.assign(e,{id:t.id}),e},F=t=>{let e={type:"text",x:t.x,y:t.y,width:t.width,height:t.height,text:tt(t.text)||"",fontSize:t.fontSize,verticalAlign:"middle"};return t.groupId&&Object.assign(e,{groupIds:[t.groupId]}),t.id&&Object.assign(e,{id:t.id}),e},q=t=>{let e={};t.type==="rectangle"&&t.subtype==="activation"&&(e={backgroundColor:"#e9ecef",fillStyle:"solid"});let r={id:t.id,type:t.type,x:t.x,y:t.y,width:t.width,height:t.height,label:{text:tt(t?.label?.text||""),fontSize:t?.label?.fontSize,verticalAlign:t.label?.verticalAlign||"middle",strokeColor:t.label?.color||"#000",groupIds:t.groupId?[t.groupId]:[]},strokeStyle:t?.strokeStyle,strokeWidth:t?.strokeWidth,strokeColor:t?.strokeColor,backgroundColor:t?.bgColor,fillStyle:"solid",...e};return t.groupId&&Object.assign(r,{groupIds:[t.groupId]}),r},H=t=>{let e={type:"arrow",x:t.startX,y:t.startY,points:t.points||[[0,0],[t.endX-t.startX,t.endY-t.startY]],width:t.endX-t.startX,height:t.endY-t.startY,strokeStyle:t?.strokeStyle||"solid",endArrowhead:t?.endArrowhead||null,startArrowhead:t?.startArrowhead||null,label:{text:tt(t?.label?.text||""),fontSize:16},roundness:{type:2},start:t.start,end:t.end};return t.groupId&&Object.assign(e,{groupIds:[t.groupId]}),e};var pt=new L({converter:t=>{let e=[],r=[];if(Object.values(t.nodes).forEach(o=>{!o||!o.length||o.forEach(n=>{let i;switch(n.type){case"line":i=M(n);break;case"rectangle":case"ellipse":i=q(n);break;case"text":i=F(n);break;default:throw`unknown type ${n.type}`}n.type==="rectangle"&&n?.subtype==="activation"?r.push(i):e.push(i)})}),Object.values(t.lines).forEach(o=>{o&&e.push(M(o))}),Object.values(t.arrows).forEach(o=>{o&&(e.push(H(o)),o.sequenceNumber&&e.push(q(o.sequenceNumber)))}),e.push(...r),t.loops){let{lines:o,texts:n,nodes:i}=t.loops;o.forEach(s=>{e.push(M(s))}),n.forEach(s=>{e.push(F(s))}),i.forEach(s=>{e.push(q(s))})}return t.groups&&t.groups.forEach(o=>{let{actorKeys:n,name:i}=o,s=1/0,a=1/0,c=0,l=0;if(!n.length)return;e.filter(g=>{if(g.id){let T=g.id.indexOf("-"),C=g.id.substring(0,T);return n.includes(C)}}).forEach(g=>{if(g.x===void 0||g.y===void 0||g.width===void 0||g.height===void 0)throw new Error(`Actor attributes missing ${g}`);s=Math.min(s,g.x),a=Math.min(a,g.y),c=Math.max(c,g.x+g.width),l=Math.max(l,g.y+g.height)});let u=10,f=s-u,m=a-u,x=c-s+u*2,b=l-a+u*2,E=O(),y=q({type:"rectangle",x:f,y:m,width:x,height:b,bgColor:o.fill,id:E});e.unshift(y);let w=O(),p=[E];e.forEach(g=>{if(g.type!=="frame"){if(g.x===void 0||g.y===void 0||g.width===void 0||g.height===void 0)throw new Error(`Element attributes missing ${g}`);if(g.x>=s&&g.x+g.width<=c&&g.y>=a&&g.y+g.height<=l){let T=g.id||O();g.id||Object.assign(g,{id:T}),p.push(T)}}});let A={type:"frame",id:w,name:i,children:p};e.push(A)}),{elements:e}}});h();var mt=new L({converter:t=>{let e=[];return Object.values(t.nodes).forEach(r=>{!r||!r.length||r.forEach(o=>{let n;switch(o.type){case"line":n=M(o);break;case"rectangle":case"ellipse":n=q(o);break;case"text":n=F(o);break;default:throw`unknown type ${o.type}`}e.push(n)})}),Object.values(t.lines).forEach(r=>{r&&e.push(M(r))}),Object.values(t.arrows).forEach(r=>{if(!r)return;let o=H(r);e.push(o)}),Object.values(t.text).forEach(r=>{let o=F(r);e.push(o)}),Object.values(t.namespaces).forEach(r=>{let o=Object.keys(r.classes),n=[...o],i=[...t.lines,...t.arrows,...t.text];o.forEach(a=>{let c=i.filter(l=>l.metadata&&l.metadata.classId===a).map(l=>l.id);c.length&&n.push(...c)});let s={type:"frame",id:O(),name:r.id,children:n};e.push(s)}),{elements:e}}});var ft=(t,e={})=>{switch(t.type){case"graphImage":return ut.convert(t,e);case"flowchart":return dt.convert(t,e);case"sequence":return pt.convert(t,e);case"class":return mt.convert(t,e);default:throw new Error(`graphToExcalidraw: unknown graph type "${t.type}, only flowcharts are supported!"`)}};h();h();var qe=z(It(),1),Be=z(Ot(),1);var Ge=z(Ct(),1);h();var Y=t=>{t=Rt(t);let e=t.replace(/#(\d+);/g,"&#$1;").replace(/#([a-z]+);/g,"&$1;"),r=document.createElement("textarea");return r.innerHTML=e,r.value},P=t=>{let r=t.getAttribute("transform")?.match(/translate\(([ \d.-]+),\s*([\d.-]+)\)/),o=0,n=0;return r&&(o=Number(r[1]),n=Number(r[2])),{transformX:o,transformY:n}},ht=t=>{let e=t;return e=e.replace(/style.*:\S*#.*;/g,r=>r.substring(0,r.length-1)),e=e.replace(/classDef.*:\S*#.*;/g,r=>r.substring(0,r.length-1)),e=e.replace(/#\w+;/g,r=>{let o=r.substring(1,r.length-1);return/^\+?\d+$/.test(o)?`\uFB02\xB0\xB0${o}\xB6\xDF`:`\uFB02\xB0${o}\xB6\xDF`}),e},Rt=function(t){return t.replace(/ﬂ°°/g,"#").replace(/ﬂ°/g,"&").replace(/¶ß/g,";")},K=(t,e={x:0,y:0})=>{if(t.tagName.toLowerCase()!=="path")throw new Error(`Invalid input: Expected an HTMLElement of tag "path", got ${t.tagName}`);let r=t.getAttribute("d");if(!r)throw new Error('Path element does not contain a "d" attribute');let o=r.split(/(?=[LM])/),n=o[0].substring(1).split(",").map(a=>parseFloat(a)),i=o[o.length-1].substring(1).split(",").map(a=>parseFloat(a)),s=o.map(a=>{let c=a.substring(1).split(",").map(l=>parseFloat(l));return{x:c[0],y:c[1]}}).filter((a,c,l)=>{if(c===0||c===l.length-1)return!0;if(a.x===l[c-1].x&&a.y===l[c-1].y)return!1;if(c===l.length-2&&(l[c-1].x===a.x||l[c-1].y===a.y)){let d=l[l.length-1];return Math.hypot(d.x-a.x,d.y-a.y)>20}return a.x!==l[c-1].x||a.y!==l[c-1].y}).map(a=>({x:a.x+e.x,y:a.y+e.y}));return{startX:n[0]+e.x,startY:n[1]+e.y,endX:i[0]+e.x,endY:i[1]+e.y,reflectionPoints:s}};h();var Yt=(t,e)=>{let r=t.nodes.map(a=>a.startsWith("flowchart-")?a.split("-")[1]:a),o=e.querySelector(`[id='${t.id}']`);if(!o)throw new Error("SubGraph element not found");let n=et(o,e),i=o.getBBox(),s={width:i.width,height:i.height};return t.classes=void 0,t.dir=void 0,{...t,nodeIds:r,...n,...s,text:Y(t.title)}},Pt=(t,e)=>{let r=e.querySelector(`[id*="flowchart-${t.id}-"]`);if(!r)return;let o;r.parentElement?.tagName.toLowerCase()==="a"&&(o=r.parentElement.getAttribute("xlink:href"));let n=et(o?r.parentElement:r,e),i=r.getBBox(),s={width:i.width,height:i.height},a=r.querySelector(".label-container")?.getAttribute("style"),c=r.querySelector(".label")?.getAttribute("style"),l={};a?.split(";").forEach(u=>{if(!u)return;let f=u.split(":")[0].trim(),m=u.split(":")[1].trim();l[f]=m});let d={};return c?.split(";").forEach(u=>{if(!u)return;let f=u.split(":")[0].trim(),m=u.split(":")[1].trim();d[f]=m}),{id:t.id,labelType:t.labelType,text:Y(t.text),type:t.type,link:o||void 0,...n,...s,containerStyle:l,labelStyle:d}},vt=(t,e,r)=>{let o=r.querySelector(`[id*="L-${t.start}-${t.end}-${e}"]`);if(!o)throw new Error("Edge element not found");let n=et(o,r),i=K(o,n);return t.length=void 0,{...t,...i,text:Y(t.text)}},et=(t,e)=>{if(!t)throw new Error("Element not found");let r=t.parentElement?.parentElement,o=t.childNodes[0],n={x:0,y:0};if(o){let{transformX:c,transformY:l}=P(o),d=o.getBBox();n={x:Number(o.getAttribute("x"))||c+d.x||0,y:Number(o.getAttribute("y"))||l+d.y||0}}let{transformX:i,transformY:s}=P(t),a={x:i+n.x,y:s+n.y};for(;r&&r.id!==e.id;){if(r.classList.value==="root"&&r.hasAttribute("transform")){let{transformX:c,transformY:l}=P(r);a.x+=c,a.y+=l}r=r.parentElement}return a},gt=(t,e)=>{t.parse();let r=t.parser.yy,o=r.getVertices();Object.keys(o).forEach(a=>{o[a]=Pt(o[a],e)});let n=new Map,i=r.getEdges().filter(a=>e.querySelector(`[id*="L-${a.start}-${a.end}"]`)).map(a=>{let c=`${a.start}-${a.end}`,l=n.get(c)||0;return n.set(c,l+1),vt(a,l,e)});return{type:"flowchart",subGraphs:r.getSubGraphs().map(a=>Yt(a,e)),vertices:o,edges:i}};h();h();var bt=(t,e)=>{let r={};e?.label&&(r.label={text:Y(e.label),fontSize:16});let o=t.tagName;if(o==="line")r.startX=Number(t.getAttribute("x1")),r.startY=Number(t.getAttribute("y1")),r.endX=Number(t.getAttribute("x2")),r.endY=Number(t.getAttribute("y2"));else if(o==="path"){let n=t.getAttribute("d");if(!n)throw new Error('Path element does not contain a "d" attribute');let i=n.split(/(?=[LC])/),s=i[0].substring(1).split(",").map(l=>parseFloat(l)),a=[];i.forEach(l=>{let d=l.substring(1).trim().split(" ").map(u=>{let[f,m]=u.split(",");return[parseFloat(f)-s[0],parseFloat(m)-s[1]]});a.push(...d)});let c=a[a.length-1];r.startX=s[0],r.startY=s[1],r.endX=c[0],r.endY=c[1],r.points=a}return e?.label&&(r.startY=r.startY-10,r.endY=r.endY-10),r.strokeColor=t.getAttribute("stroke"),r.strokeWidth=Number(t.getAttribute("stroke-width")),r.type="arrow",r.strokeStyle=e?.strokeStyle||"solid",r.startArrowhead=e?.startArrowhead||null,r.endArrowhead=e?.endArrowhead||null,r},rt=(t,e,r,o,n)=>{let i={};return i.type="arrow",i.startX=t,i.startY=e,i.endX=r,i.endY=o,Object.assign(i,{...n}),i},Z=(t,e,r,o)=>({type:"text",x:t,y:e,text:r,width:o?.width||20,height:o?.height||20,fontSize:o?.fontSize||20,id:o?.id,groupId:o?.groupId,metadata:o?.metadata}),ot=(t,e,r)=>{let o={},n=Number(t.getAttribute("x")),i=Number(t.getAttribute("y"));o.type="text",o.text=Y(e),r?.id&&(o.id=r.id),r?.groupId&&(o.groupId=r.groupId);let s=t.getBBox();o.width=s.width,o.height=s.height,o.x=n-s.width/2,o.y=i;let a=parseInt(getComputedStyle(t).fontSize);return o.fontSize=a,o},N=(t,e,r={})=>{let o={};o.type=e;let{label:n,subtype:i,id:s,groupId:a}=r;o.id=s,a&&(o.groupId=a),n&&(o.label={text:Y(n.text),fontSize:16,verticalAlign:n?.verticalAlign});let c=t.getBBox();switch(o.x=c.x,o.y=c.y,o.width=c.width,o.height=c.height,o.subtype=i,i){case"highlight":let l=t.getAttribute("fill");l&&(o.bgColor=l);break;case"note":o.strokeStyle="dashed";break}return o},B=(t,e,r,o,n,i)=>{let s={};return s.startX=e,s.startY=r,s.endX=o,i?.groupId&&(s.groupId=i.groupId),i?.id&&(s.id=i.id),s.endY=n,s.strokeColor=t.getAttribute("stroke"),s.strokeWidth=Number(t.getAttribute("stroke-width")),s.type="line",s};var xt={0:"SOLID",1:"DOTTED",3:"SOLID_CROSS",4:"DOTTED_CROSS",5:"SOLID_OPEN",6:"DOTTED_OPEN",24:"SOLID_POINT",25:"DOTTED_POINT"},_={SOLID:0,DOTTED:1,NOTE:2,SOLID_CROSS:3,DOTTED_CROSS:4,SOLID_OPEN:5,DOTTED_OPEN:6,LOOP_START:10,LOOP_END:11,ALT_START:12,ALT_ELSE:13,ALT_END:14,OPT_START:15,OPT_END:16,ACTIVE_START:17,ACTIVE_END:18,PAR_START:19,PAR_AND:20,PAR_END:21,RECT_START:22,RECT_END:23,SOLID_POINT:24,DOTTED_POINT:25,AUTONUMBER:26,CRITICAL_START:27,CRITICAL_OPTION:28,CRITICAL_END:29,BREAK_START:30,BREAK_END:31,PAR_OVER_START:32},Xt=t=>{let e;switch(t){case _.SOLID:case _.SOLID_CROSS:case _.SOLID_OPEN:case _.SOLID_POINT:e="solid";break;case _.DOTTED:case _.DOTTED_CROSS:case _.DOTTED_OPEN:case _.DOTTED_POINT:e="dotted";break;default:e="solid";break}return e},$t=(t,e)=>{if(!!t.nextElementSibling?.classList.contains("sequenceNumber")){let o=t.nextElementSibling?.textContent;if(!o)throw new Error("sequence number not present");let n=30,i=n/2,s=10,a={type:"rectangle",x:e.startX-s,y:e.startY-i,label:{text:o,fontSize:14},bgColor:"#e9ecef",height:n,subtype:"sequence"};Object.assign(e,{sequenceNumber:a})}},yt=(t,e,r)=>{if(!t)throw"root node not found";let o=O(),n=Array.from(t.children),i=[];return n.forEach((s,a)=>{let c=`${r?.id}-${a}`,l;switch(s.tagName){case"line":let d=Number(s.getAttribute("x1")),u=Number(s.getAttribute("y1")),f=Number(s.getAttribute("x2")),m=Number(s.getAttribute("y2"));l=B(s,d,u,f,m,{groupId:o,id:c});break;case"text":l=ot(s,e,{groupId:o,id:c});break;case"circle":l=N(s,"ellipse",{label:s.textContent?{text:s.textContent}:void 0,groupId:o,id:c});default:l=N(s,st[s.tagName],{label:s.textContent?{text:s.textContent}:void 0,groupId:o,id:c})}i.push(l)}),i},Mt=(t,e)=>{let r=Array.from(e.querySelectorAll(".actor-top")),o=Array.from(e.querySelectorAll(".actor-bottom")),n=[],i=[];return Object.values(t).forEach((s,a)=>{let c=r.find(u=>u.getAttribute("name")===s.name),l=o.find(u=>u.getAttribute("name")===s.name);if(!c||!l)throw"root not found";let d=s.description;if(s.type==="participant"){let u=N(c,"rectangle",{id:`${s.name}-top`,label:{text:d},subtype:"actor"});if(!u)throw"Top Node element not found!";n.push([u]);let f=N(l,"rectangle",{id:`${s.name}-bottom`,label:{text:d},subtype:"actor"});n.push([f]);let m=c?.parentElement?.previousElementSibling;if(m?.tagName!=="line")throw"Line not found";let x=Number(m.getAttribute("x1"));if(!u.height)throw"Top node element height is null";let b=u.y+u.height,E=f.y,y=Number(m.getAttribute("x2")),w=B(m,x,b,y,E);i.push(w)}else if(s.type==="actor"){let u=yt(c,d,{id:`${s.name}-top`});n.push(u);let f=yt(l,d,{id:`${s.name}-bottom`});n.push(f);let m=c.previousElementSibling;if(m?.tagName!=="line")throw"Line not found";let x=Number(m.getAttribute("x1")),b=Number(m.getAttribute("y1")),E=Number(m.getAttribute("x2")),y=f.find(w=>w.type==="ellipse");if(y){let w=y.y,p=B(m,x,b,E,w);i.push(p)}}}),{nodes:n,lines:i}},qt=(t,e)=>{let r=[],o=Array.from(e.querySelectorAll('[class*="messageLine"]')),n=Object.keys(xt),i=t.filter(s=>n.includes(s.type.toString()));return o.forEach((s,a)=>{let c=i[a],l=xt[c.type],d=bt(s,{label:c?.message,strokeStyle:Xt(c.type),endArrowhead:l==="SOLID_OPEN"||l==="DOTTED_OPEN"?null:"arrow"});$t(s,d),r.push(d)}),r},Bt=(t,e)=>{let r=Array.from(e.querySelectorAll(".note")).map(i=>i.parentElement),o=t.filter(i=>i.type===_.NOTE),n=[];return r.forEach((i,s)=>{if(!i)return;let a=i.firstChild,c=o[s].message,l=N(a,"rectangle",{label:{text:c},subtype:"note"});n.push(l)}),n},Ft=t=>{let e=Array.from(t.querySelectorAll("[class*=activation]")),r=[];return e.forEach(o=>{let n=N(o,"rectangle",{label:{text:""},subtype:"activation"});r.push(n)}),r},Gt=(t,e)=>{let r=Array.from(e.querySelectorAll(".loopLine")),o=[],n=[],i=[];r.forEach(d=>{let u=Number(d.getAttribute("x1")),f=Number(d.getAttribute("y1")),m=Number(d.getAttribute("x2")),x=Number(d.getAttribute("y2")),b=B(d,u,f,m,x);b.strokeStyle="dotted",b.strokeColor="#adb5bd",b.strokeWidth=2,o.push(b)});let s=Array.from(e.querySelectorAll(".loopText")),a=t.filter(d=>d.type===_.CRITICAL_START).map(d=>d.message);s.forEach(d=>{let u=d.textContent||"",f=ot(d,u),m=u.match(/\[(.*?)\]/)?.[1]||"";a.includes(m)&&(f.x+=16),n.push(f)});let c=Array.from(e?.querySelectorAll(".labelBox")),l=Array.from(e?.querySelectorAll(".labelText"));return c.forEach((d,u)=>{let f=l[u]?.textContent||"",m=N(d,"rectangle",{label:{text:f}});m.strokeColor="#adb5bd",m.bgColor="#e9ecef",m.width=void 0,i.push(m)}),{lines:o,texts:n,nodes:i}},jt=t=>{let e=Array.from(t.querySelectorAll(".rect")).filter(o=>o.parentElement?.tagName!=="g"),r=[];return e.forEach(o=>{let n=N(o,"rectangle",{label:{text:""},subtype:"highlight"});r.push(n)}),r},Et=(t,e)=>{t.parse();let r=t.parser.yy,o=[],n=r.getBoxes(),i=jt(e),s=r.getActors(),{nodes:a,lines:c}=Mt(s,e),l=r.getMessages(),d=qt(l,e),u=Bt(l,e),f=Ft(e),m=Gt(l,e);return o.push(i),o.push(...a),o.push(u),o.push(f),{type:"sequence",lines:c,arrows:d,nodes:o,loops:m,groups:n}};h();var Q={AGGREGATION:0,EXTENSION:1,COMPOSITION:2,DEPENDENCY:3,LOLLIPOP:4},St={LINE:0,DOTTED_LINE:1},v=16,Ut=t=>{let e;switch(t){case St.LINE:e="solid";break;case St.DOTTED_LINE:e="dotted";break;default:e="solid"}return e},wt=t=>{let e;switch(t){case Q.AGGREGATION:e="diamond_outline";break;case Q.COMPOSITION:e="diamond";break;case Q.EXTENSION:e="triangle_outline";break;case"none":e=null;break;case Q.DEPENDENCY:default:e="arrow";break}return e},zt=(t,e)=>{let r=[],o=[],n=[];return Object.values(t).forEach(i=>{let{domId:s,id:a}=i,c=O(),l=e.querySelector(`[data-id=${a}]`);if(!l)throw Error(`DOM Node with id ${s} not found`);let{transformX:d,transformY:u}=P(l),f=N(l.firstChild,"rectangle",{id:a,groupId:c});f.x+=d,f.y+=u,f.metadata={classId:a},r.push(f),Array.from(l.querySelectorAll(".divider")).forEach(b=>{let E=Number(b.getAttribute("x1")),y=Number(b.getAttribute("y1")),w=Number(b.getAttribute("x2")),p=Number(b.getAttribute("y2")),A=B(b,E,y,w,p,{groupId:c,id:O()});A.startX+=d,A.startY+=u,A.endX+=d,A.endY+=u,A.metadata={classId:a},o.push(A)});let x=l.querySelector(".label")?.children;if(!x)throw"label nodes not found";Array.from(x).forEach(b=>{let E=b.textContent;if(!E)return;let y=O(),{transformX:w,transformY:p}=P(b),A=b.getBBox(),g=10,T=Z(d+w,u+p+g,E,{width:A.width,height:A.height,id:y,groupId:c,metadata:{classId:a}});n.push(T)})}),{nodes:r,lines:o,text:n}},Vt=(t,e)=>{let r=["triangle_outline","diamond","diamond_outline"],o=e.startArrowhead&&r.includes(e.startArrowhead),n=e.endArrowhead&&r.includes(e.endArrowhead);return!n&&!o||(o&&(t==="LR"?e.startX-=v:t==="RL"?e.startX+=v:t==="TB"?e.startY-=v:t==="BT"&&(e.startY+=v)),n&&(t==="LR"?e.endX+=v:t==="RL"?e.endX-=v:t==="TB"?e.endY+=v:t==="BT"&&(e.endY-=v))),e},Wt=(t,e,r,o)=>{let n=r.querySelector(".edgePaths")?.children;if(!n)throw new Error("No Edges found!");let i=[],s=[];return t.forEach((a,c)=>{let{id1:l,id2:d,relation:u}=a,f=e.find(X=>X.id===l),m=e.find(X=>X.id===d),x=Ut(u.lineType),b=wt(u.type1),E=wt(u.type2),y=K(n[c]),w=rt(y.startX,y.startY,y.endX,y.endY,{strokeStyle:x,startArrowhead:b,endArrowhead:E,label:a.title?{text:a.title}:void 0,start:{type:"rectangle",id:f.id},end:{type:"rectangle",id:m.id}}),p=Vt(o,w);i.push(p);let{relationTitle1:A,relationTitle2:g}=a,T=20,C=15,D=15,k,I;if(A&&A!=="none"){switch(o){case"TB":k=p.startX-T,p.endX<p.startX&&(k-=D),I=p.startY+C;break;case"BT":k=p.startX+T,p.endX>p.startX&&(k+=D),I=p.startY-C;break;case"LR":k=p.startX+T,I=p.startY+C,p.endY>p.startY&&(I+=D);break;case"RL":k=p.startX-T,I=p.startY-C,p.startY>p.endY&&(I-=D);break;default:k=p.startX-T,I=p.startY+C}let X=Z(k,I,A,{fontSize:16});s.push(X)}if(g&&g!=="none"){switch(o){case"TB":k=p.endX+T,p.endX<p.startX&&(k+=D),I=p.endY-C;break;case"BT":k=p.endX-T,p.endX>p.startX&&(k-=D),I=p.endY+C;break;case"LR":k=p.endX-T,I=p.endY-C,p.endY>p.startY&&(I-=D);break;case"RL":k=p.endX+T,I=p.endY+C,p.startY>p.endY&&(I+=D);break;default:k=p.endX+T,I=p.endY-C}let X=Z(k,I,g,{fontSize:16});s.push(X)}}),{arrows:i,text:s}},Ht=(t,e,r)=>{let o=[],n=[];return t.forEach(i=>{let{id:s,text:a,class:c}=i,l=e.querySelector(`#${s}`);if(!l)throw new Error(`Node with id ${s} not found!`);let{transformX:d,transformY:u}=P(l),f=l.firstChild,m=N(f,"rectangle",{id:s,subtype:"note",label:{text:a}});if(Object.assign(m,{x:m.x+d,y:m.y+u}),o.push(m),c){let x=r.find(A=>A.id===c);if(!x)throw new Error(`class node with id ${c} not found!`);let b=m.x+(m.width||0)/2,E=m.y+(m.height||0),y=b,w=x.y,p=rt(b,E,y,w,{strokeStyle:"dotted",startArrowhead:null,endArrowhead:null,start:{id:m.id,type:"rectangle"},end:{id:x.id,type:"rectangle"}});n.push(p)}}),{notes:o,connectors:n}},At=(t,e)=>{t.parse();let r=t.parser.yy,o=r.getDirection(),n=[],i=[],s=[],a=[],c=r.getNamespaces(),l=r.getClasses();if(Object.keys(l).length){let b=zt(l,e);n.push(b.nodes),i.push(...b.lines),s.push(...b.text),a.push(...b.nodes)}let d=r.getRelations(),{arrows:u,text:f}=Wt(d,a,e,o),{notes:m,connectors:x}=Ht(r.getNotes(),e,a);return n.push(m),u.push(...x),s.push(...f),{type:"class",nodes:n,lines:i,arrows:u,text:s,namespaces:c}};var Kt=t=>{let e=t.querySelector("svg");if(!e)throw new Error("SVG element not found");let r=e.getBoundingClientRect(),o=r.width,n=r.height;e.setAttribute("width",`${o}`),e.setAttribute("height",`${n}`);let i="image/svg+xml",s=unescape(encodeURIComponent(e.outerHTML)),c=`data:image/svg+xml;base64,${btoa(s)}`;return{type:"graphImage",mimeType:i,dataURL:c,width:o,height:n}},Tt=async(t,e=J)=>{G.initialize({...J,...e});let r=await G.mermaidAPI.getDiagramFromText(ht(t)),{svg:o}=await G.render("mermaid-to-excalidraw",t),n=document.createElement("div");n.setAttribute("style","opacity: 0; position: relative; z-index: -1;"),n.innerHTML=o,n.id="mermaid-diagram",document.body.appendChild(n);let i;switch(r.type){case"flowchart-v2":{i=gt(r,n);break}case"sequence":{i=Et(r,n);break}case"classDiagram":{i=At(r,n);break}default:i=Kt(n)}return n.remove(),i};var wr=async(t,e)=>{let r=e||{},o=parseInt(r.themeVariables?.fontSize??"")||20,n=await Tt(t,{...r,themeVariables:{...r.themeVariables,fontSize:`${o*1.25}px`}});return ft(n,{fontSize:o})};export{wr as parseMermaidToExcalidraw};
